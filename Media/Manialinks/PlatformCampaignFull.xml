<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<manialink name="Page_HomePage" version="3">
	<stylesheet>
		<style id="LabelWelcome" posn="-128 49" style="TextTitle1" sizen="40 5"/>
		<style id="LabelActivity" posn="-128 43" style="TextSubTitle1" sizen="44 5"/>		
		<style id="SoloBTN EditorsBTN WhiteBTN GreenBTN BlueBTN RedBTN BlackBTN" style="TextButtonBig"/>
		
		<style id="MultiBTN LocalBTN ProfileBTN" textcolor="999" style="TextButtonBig"/>
		<style id="1 2 3 4 5"  style="Icons128x128_1" sizen="9 9" halign="right" valign="center"/>
		
		<style id="M_Medal1 M_Medal2 M_Medal3 M_Medal4 M_Medal5 M_Medal6 M_Medal7 M_Medal8 M_Medal9 M_Medal10 M_Medal11 M_Medal12 M_Medal13 M_Medal14 M_Medal15" style="MedalsBig" substyle="MedalSlot" pos="-38 24" z-index="25" size="10 10"/> 	
		<style id="Zamocek0" pos="-46 39" z-index="3" size="15 14" style="Icons128x128_1" substyle="Padlock" scriptevents="1" halign="center"/>
		<style id="M_Name1 M_Name2 M_Name3 M_Name4 M_Name5 M_Name6 M_Name7 M_Name8 M_Name9 M_Name10 M_Name11 M_Name12 M_Name13 M_Name14 M_Name15" posn="-46 15.5" sizen="30 6"  style="TextButtonBig" textsize="0.6" valign="center2" z-index="10" halign="center" textemboss="1"/>		
		<style id="M_SP1 M_SP2 M_SP3 M_SP4 M_SP5 M_SP6 M_SP7 M_SP8 M_SP9 M_SP10 M_SP11 M_SP12 M_SP13 M_SP14 M_SP15" style="TextRaceChronoOfficial" textsize="2.8" valign="center2" z-index="10"/>		
		<style id="M_Icon1 M_Icon2 M_Icon3 M_Icon4 M_Icon5 M_Icon6 M_Icon7 M_Icon8 M_Icon9 M_Icon10 M_Icon11 M_Icon12 M_Icon13 M_Icon14 M_Icon15" keepratio="Clip" size="30 30"  hidden="1" bgcolor="FFA"/>
		<style id="M_Main1 M_Main2 M_Main3 M_Main4 M_Main5 M_Main10 M_Main6 M_Main8 M_Main7 M_Main9 M_Main11 M_Main12 M_Main13 M_Main14 M_Main15" size="32 36" style="Bgs1" substyle="BgButtonSmall"/>
		<style id="P1 P2 P3 P4 P5 P6 P7 P8 P9 P10" pos="69 75" z-index="5" size="70 4" style="TextChallengeNameSmall" textsize="2.0" valign="center" textcolor="FFFFFFFF"/>
	</stylesheet>
	
<frame z-index="-1" id="FrameMenuCommon">	
	<quad style="Bgs1" substyle="BgButtonOff" posn="-150 92" sizen="70 183" z-index="-4"/>
	<quad id="Titlelogo"  sizen="70 70" pos="-150 90" z-index="-0.151" style="TitleLogos" substyle="Title" image="file://Media/Images/MenuHeader.png" hidden="1"/>
	<frame id="BackBTN">
		<label id="xko" text="Back" scriptevents="1" posn="-160 -72" style="CardMain_Quit" sizen="46.4 6" textsize="3.5" translate="1" z-index="10"/>
		<quad sizen="13 13" posn="-157 -75" z-index="10" halign="left" style="Icons128x128_1" substyle="BackFocusable" hidden="1"/>	
	</frame>
</frame>
<frame id="LockFrame" z-index="100" hidden="1">	
	<quad style="Bgs1" substyle="BgCardProperty"  posn="0 17" sizen="168 25" z-index="-5" halign="center" hidden="0"/>
	<quad style="Bgs1InRace" substyle="BgGlow2"  posn="0 20" sizen="174 8" z-index="1" halign="center"/>	
	<quad style="Bgs1" substyle="BgMetalBar"  posn="0 -8" sizen="168 1.5" halign="center"/>		
	<label  z-index="3" size="157 5" valign="center" pos="-78.5 7" translate="1" autonewline="1" style="TextCardMedium" id="LockR" text="Locked" textsize="2.2"/>
	<label pos="0 1" z-index="21" size="50.5 5" text="OK" style="CardButtonMediumL" textsize="3" textcolor="222222FF" halign="center" translate="1" id="HideMessageDialog" scriptevents="1"/>
	<quad pos="0 0" z-index="0" size="400 200" halign="center" valign="center" scriptevents="1" style="Bgs1" substyle="BgEmpty"/>
</frame>





<frame id="FrameMainMenu" hidden="">
	<frame id="MainPanel" z-index="-4">				
		<label id="LabelWelcome" text="Welcome" posn="-128 49" sizen="34 8" translate="1"/>
		<label id="LabelActivity" text="Choose an activity" posn="-128 42" sizen="60 10" translate="1"/>
	</frame>	
	
	<frame id="FrameDemoInfo" pos="40">
	<quad size="200 40" opacity="0.7" style="Bgs1" substyle="BgCardProperty" halign="center" valign="center"/>
	<label pos="-95 15" z-index="1" size="190 30" text="Welcome! This is a big temporary wall of text. As you can see, there is plenty of unfinished work here. Solo is the only thing that works now xd ...to access editors, you have to use OpenPlanet's menu (for now). This message should also remind you to not share this private and unfinished stuff. BUT, you can invite your friends to our Discord, so I can add them here and we can build an awesome project together!" halign="left" autonewline="1" style="TextCardInfoSmall" textsize="3"/>
	</frame>
	
	<frame id="FrameMenuButtons" pos="-144 27.5">
		<frame pos="-2 -14.5" scale=".92">
			<label id="SoloBTN" text="Solo" scriptevents="1" sizen="60 17" posn="3 12" valign="center2" translate="1" textemboss="1"/>
			<label id="MultiBTN" text="Multi" scriptevents="1" sizen="60 17" posn="3 -1" translate="1" valign="center2" textemboss="1"/>
			<label id="LocalBTN" text="Local" scriptevents="1" sizen="60 17" pos="3 -14" z-index="0" valign="center2" translate="1" textemboss="1"/>
			<label id="EditorsBTN" text="Editors" scriptevents="1" sizen="60 16" posn="3 -66" translate="1" valign="center2" textemboss="1"/>		
			<label id="ProfileBTN" text="Profile" scriptevents="1" sizen="60 17" pos="3 -79" z-index="5" translate="1" valign="center2" textemboss="1"/>
		</frame>
		
		<quad id="aa" style="Icons128x128_1"  sizen="16 16" pos="-2 24" z-index="-0.151" substyle="Vehicles"/>
		<quad id="1" pos="59 -3.5" substyle="Solo"/>
		<quad id="2" pos="59 -15" substyle="Multiplayer"/>
		<quad id="3" pos="59 -27" substyle="Hotseat"/>
		<quad id="4" pos="59 -75" substyle="Editors"/>
		<quad id="5" pos="59 -86" substyle="Profile"/>
	</frame>
</frame>
	

	
	
	
	
<frame id="FrameSolo" hidden="1">
	<frame id="MainPanel" z-index="-4">				
		<label id="LabelWelcome" text="Play Solo" posn="-128 49" sizen="34 8" translate="1"/>
		<label id="LabelActivity" text="Choose a difficulty" posn="-128 42" sizen="60 10" translate="1"/>
	</frame>	
	
	<frame id="nocol" z-index="20" hidden="1">
		<label pos="40 32" z-index="11" size="220 22" text="Choose a difficulty" translate="1" halign="center" valign="center" style="TextTitle3" textsize="6" textcolor="FFFFFFFF" textemboss="1"/>
		<quad pos="40 -2" z-index="11" size="55 77" bgcolor="FFFA" style="Icons128x128_Blink" substyle="BackFocusable" halign="center" valign="center"/>
		<quad style="Bgs1InRace" substyle="BgGradRight"  posn="39.9 94.7" sizen="263 189" z-index="10" halign="center" scriptevents="1"/>
	</frame>
	
	<frame id="MedalsTotal" hidden="0" z-index="-2">	
		<quad style="Bgs1" substyle="BgList"  sizen="38 10" posn="-30 54" z-index="-1"/>	
		<label id="MedalsLabel" sizen="30 14" posn="-19 49" style="TextRankingsBig" textsize="4" text="0" valign="center" halign="center" z-index="2"/>	
		<quad pos="-4 54" z-index="2" size="10 10" style="Icons128x128_1" substyle="MedalCount"/>
		<quad style="Bgs1" substyle="BgCardProperty"  posn="40 56.5" sizen="168 16" z-index="-5" halign="center"/>
		<quad style="Bgs1InRace" substyle="BgGlow2"  posn="40 71" sizen="174 8" z-index="1" halign="center"/>	
		<label id="header" text="Your Medals World Ranking" sizen="189 5" posn="41 62" style="TextTitle3" textsize="2.5" translate="1" halign="center" valign="center"/>
		<quad style="Bgs1" substyle="BgTitle"  posn="40 67" sizen="168 11" halign="center"/>
		<quad style="Bgs1" substyle="BgMetalBar"  posn="40 41" sizen="168 1.5" halign="center"/>
	</frame>
			
	<frame id="MedalsMap" hidden="1" z-index="1" pos="0 0">
		<label pos="-26 62" z-index="0" size="61 9" text="Country" id="Zone_" style="TextRankingsBig" textsize="2" translate="1" valign="center2" textcolor="000000FF"/>
		<quad pos="-35 66" z-index="5" size="8 8" id="Flag" style="Icons128x128_1" substyle="Vehicles"/>
		<quad pos="-38 67" z-index="-1" size="75 10" bgcolor="FFFA" style="Bgs1" substyle="BgCardPlayer"/>
		<quad id="Left" pos="-43 62" z-index="0" size="8 8" halign="center" valign="center" scriptevents="1" style="Icons128x128_1" substyle="BackFocusable"/>
		<quad id="Right" pos="42 62" z-index="0" size="8 8" halign="center" valign="center" scriptevents="1" style="Icons128x128_1" substyle="BackFocusable" scale="-1"/>
		<quad style="Bgs1" substyle="BgButtonOff"  posn="40.5 81.7" sizen="189 42" z-index="-2" halign="center" scriptevents="1" id="QQ"/>
		
		<frame id="Skillpointsframe" hidden="1">
			<quad pos="-44 58" z-index="2" size="15 15" style="Icons128x128_1" substyle="SkillPoints"/>
			<quad style="Bgs1" substyle="BgList"  sizen="50 10" posn="-46 55" z-index="-1"/>				
			<label pos="-26 49.5" z-index="0" size="25 12" style="TextRaceChrono" textsize="4.5" valign="center2" id="SPMap" text="0"/>		
		</frame>
		
		<label id="header0" text="Official time rankings for this Map" sizen="102 5" posn="1 78" style="TextButtonBig" textsize="2.5" translate="1" halign="center"/>
		<label pos="6 54" z-index="0" size="16 5" text="Time" translate="1" textsize="2" style="TextCardRaceRank"/>
		<label pos="6 49" z-index="0" size="20 5" text="Platform" translate="1" textsize="2" style="TextTitle2"/>
		<label pos="24 54" z-index="50" size="21 5" textsize="2" style="TextRankingsBig" textcolor="0085CCFF" id="TrainingMap" translate="1" text="0:00:00"/>
		<label pos="24 49" z-index="50" size="35 5" text="No record" translate="1" textsize="2" style="TextRankingsBig" textcolor="0085CCFF" id="PlatformRecordMap"/>
		
		<frame hidden="0" pos="1 10" scale=".9">
			<label scriptevents="1" id="P1"/>
			<label scriptevents="1" id="P2" pos="69 71"/>
			<label scriptevents="1" id="P3" pos="69 67"/>
			<label scriptevents="1" id="P4" pos="69 63"/>			
			<label scriptevents="1" id="P5" pos="69 59"/>
			<label scriptevents="1" id="P6" pos="69 55"/>
			<label scriptevents="1" id="P7" pos="69 51"/>
			<label scriptevents="1" id="P8" pos="69 47"/>
			<label scriptevents="1" id="P9" pos="69 43"/>
			<label scriptevents="1" id="P10" pos="69 39"/>
		</frame>
	</frame>			
	
	<frame id="FrameMenuButtons" pos="-144 27.5">
		<frame pos="-2 -14.5" scale=".92">
			<label id="WhiteBTN" text="White" scriptevents="1" sizen="59 17" posn="3 12" valign="center2" translate="1" textemboss="1"/>
			<label id="GreenBTN" text="Green" scriptevents="1" sizen="61 17" posn="3 -1" translate="1" valign="center2" textemboss="1"/>
			<label id="BlueBTN" text="Blue" scriptevents="1" sizen="56 17" pos="3 -14" z-index="0" valign="center2" translate="1" textemboss="1"/>
			<label id="RedBTN" text="Red" scriptevents="1" sizen="55 17" pos="3 -27" z-index="5" translate="1" valign="center2" textemboss="1"/>
			<label id="BlackBTN" text="Black" scriptevents="1" sizen="61 16" posn="3 -40" translate="1" valign="center2" textemboss="1"/>
		</frame>
		
		<quad id="aa" style="Icons128x128_1"  sizen="16 16" pos="-2 24" z-index="-0.151" substyle="Solo"/>
		<quad id="1" pos="59 -3.5" substyle="Beginner"/>
		<quad id="2" pos="59 -15" substyle="Easy" />
		<quad id="3" pos="59 -27" substyle="Medium"/>
		<quad id="4" pos="59 -39" substyle="Hard"/>
		<quad id="5" pos="59 -51" substyle="Extreme"/>
	</frame>
	
	<frame pos="0 -8">	
		<frame id="GG" z-index="-25">	
			<quad pos="32 -71" z-index="0" size="8 8"style="Icons128x128_1" substyle="BackFocusable"  halign="center" valign="center" scriptevents="1" rot="90" id="Up"/>
			<quad id="Down" pos="48 -71" z-index="0" size="8 8" rot="-90" style="Icons128x128_1" substyle="BackFocusable" halign="center" valign="center" scriptevents="1"/>
			<quad id="M_Main1" pos="-44 45" scriptevents="1" hidden="1" />				
			<quad id="M_Main2" pos="-10 45" scriptevents="1" hidden="1"/>
			<quad id="M_Main3" pos="24 45" scriptevents="1" hidden="1"/>
			<quad id="M_Main4" pos="58 45" scriptevents="1" hidden="1"/>
			<quad id="M_Main5" pos="92 45" scriptevents="1" hidden="1"/>
			<quad id="M_Main6" pos="-44 9" scriptevents="1" hidden="1"/>				
			<quad id="M_Main7" pos="-10 9" scriptevents="1" hidden="1"/>
			<quad id="M_Main8" pos="24 9" scriptevents="1" hidden="1"/>
			<quad id="M_Main9" pos="58 9" scriptevents="1" hidden="1"/>
			<quad id="M_Main10" pos="92 9" scriptevents="1" hidden="1"/>	
			<quad id="M_Main11" pos="-44 -27" scriptevents="1" hidden="1"/>				
			<quad id="M_Main12" pos="-10 -27" scriptevents="1" hidden="1"/>
			<quad id="M_Main13" pos="24 -27" scriptevents="1" hidden="1"/>
			<quad id="M_Main14" pos="58 -27" scriptevents="1" hidden="1"/>
			<quad id="M_Main15" pos="92 -27" scriptevents="1" hidden="1"/>					
		</frame>
		
		<frame z-index="-8">
			<quad id="M_Icon1" pos="-43 44" hidden="1"/>
			<quad id="M_Icon2" pos="-9 44" hidden="1"/>
			<quad id="M_Icon3" pos="25 44" hidden="1"/>
			<quad id="M_Icon4" pos="59 44" hidden="1"/>
			<quad id="M_Icon5" pos="93 44" hidden="1"/>
			<quad id="M_Icon6"  pos="-43 8" hidden="1"/>
			<quad id="M_Icon7" pos="-9 8" hidden="1"/>
			<quad id="M_Icon8" pos="25 8" hidden="1"/>
			<quad id="M_Icon9" pos="59 8" hidden="1"/>
			<quad id="M_Icon10" pos="93 8" hidden="1"/>
			<quad id="M_Icon11" pos="-43 -28" hidden="1"/>
			<quad id="M_Icon12" pos="-9 -28" hidden="1"/>
			<quad id="M_Icon13" pos="25 -28" hidden="1"/>
			<quad id="M_Icon14" pos="59 -28" hidden="1"/>
			<quad id="M_Icon15" pos="93 -28" hidden="1"/>
		</frame>
	
		<frame id="Str1" hidden="0" z-index="10">	
			<label id="M_Name1" pos="-28 12"/>
			<label id="M_Name2" pos="6 12"/>
			<label id="M_Name3" pos="40 12"/>
			<label id="M_Name4" pos="74 12"/>
			<label id="M_Name5" pos="108 12"/>
			<label id="M_Name6" pos="-28 -24"/>
			<label id="M_Name7" pos="6 -24"/>
			<label id="M_Name8" pos="40 -24"/>
			<label id="M_Name9" pos="74 -24"/>
			<label id="M_Name10" pos="108 -24"/>
			<label id="M_Name11" pos="-28 -60"/>
			<label id="M_Name12" pos="6 -60"/>
			<label id="M_Name13" pos="40 -60"/>
			<label id="M_Name14" pos="74 -60"/>
			<label id="M_Name15" pos="108 -60"/>
		</frame>
		<frame pos="-13 7">	
			<label id="M_PlatformRecord1" textemboss="1" pos="-28 12"/>
			<label id="M_PlatformRecord2" textemboss="1" pos="6 12"/>
			<label id="M_PlatformRecord3" textemboss="1" pos="40 12"/>
			<label id="M_PlatformRecord4" textemboss="1" pos="74 12"/>
			<label id="M_PlatformRecord5" textemboss="1" pos="108 12"/>
			<label id="M_PlatformRecord6" textemboss="1" pos="-28 -24"/>
			<label id="M_PlatformRecord7" textemboss="1" pos="6 -24"/>
			<label id="M_PlatformRecord8" textemboss="1" pos="40 -24"/>
			<label id="M_PlatformRecord9" textemboss="1" pos="74 -24"/>
			<label id="M_PlatformRecord10" textemboss="1" pos="108 -24"/>
			<label id="M_PlatformRecord11" textemboss="1" pos="-28 -60"/>
			<label id="M_PlatformRecord12" textemboss="1" pos="6 -60"/>
			<label id="M_PlatformRecord13" textemboss="1" pos="40 -60"/>
			<label id="M_PlatformRecord14" textemboss="1" pos="74 -60"/>
			<label id="M_PlatformRecord15" textemboss="1" pos="108 -60"/>
		</frame>
		
		<frame z-index="0">
			<quad id="M_Medal1" hidden="1" pos="-23 24"/>
			<quad id="M_Medal2" hidden="1" pos="11 24"/>
			<quad id="M_Medal3" hidden="1" pos="45 24"/>
			<quad id="M_Medal4" hidden="1" pos="79 24"/>
			<quad id="M_Medal5" hidden="1" pos="113 24"/>
			<quad id="M_Medal6" hidden="1" pos="-23 -12"/>
			<quad id="M_Medal7" hidden="1" pos="11 -12"/>
			<quad id="M_Medal8" hidden="1" pos="45 -12"/>
			<quad id="M_Medal9" hidden="1" pos="79 -12"/>
			<quad id="M_Medal10" hidden="1" pos="113 -12"/>
			<quad id="M_Medal11" hidden="1" pos="-23 -48"/>
			<quad id="M_Medal12" hidden="1" pos="11 -48"/>
			<quad id="M_Medal13" hidden="1" pos="45 -48"/>
			<quad id="M_Medal14" hidden="1" pos="79 -48"/>
			<quad id="M_Medal15" hidden="1" pos="113 -48"/>
		
			<frame id="M_Lock1" hidden="1" z-index="20">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock2" hidden="1" z-index="20">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock3" hidden="1" z-index="20">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock4" hidden="1" z-index="20">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock5" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock6" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock7" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock8" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock9" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock10" hidden="1">
				<quad id="Zamocek0"/>
			</frame>		
			<frame id="M_Lock11" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock12" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock13" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock14" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
			<frame id="M_Lock15" hidden="1">
				<quad id="Zamocek0"/>
			</frame>
		</frame>
	</frame>
</frame>

<script><!--

declare Integer[CMapInfo] MapRecords;
declare Integer[CMapInfo] MapMedals;
declare Integer MedalsTotal;
declare Text CampaignPath;

Void Deselect()	{
	for (yy, 1, 15) {
		(Page.GetFirstChild("M_Main"^yy) as CMlQuad).StyleSelected = False;
	}
}
Void RefreshRank()	{
	for (yy, 1, 10) {
		(Page.GetFirstChild("P"^yy) as CMlLabel).SetText("");
	}
}

Text TimeToText(Integer _score, Boolean _useMS)	{
	// Dirty as hell, I would rather use TL but it crashes the scripts so...
	declare hours = _score / (60000 * 60);
	declare minutes = _score / 60000 - hours * 60;
	declare seconds = _score / 1000 - minutes * 60;
	declare ms = (_score - seconds * 1000 - minutes * 60000) / 10;
	
	declare secondsText = ":"^seconds;
	if (seconds < 10)
		secondsText = ":0"^seconds;
	
	declare Text msText;

	if(_useMS)	{
		msText = "."^ms;
		if (ms < 10)
			msText = ".0"^ms;
	}

	if(hours == 0)
		return minutes ^ secondsText ^ msText;
	else
		return hours ^ ":" ^ minutes ^ secondsText ^ msText;
	return "";
}

CGhost Map_GetRecordGhost(Text MapName)	{
	declare MapGhosts = DataFileMgr.Replay_Load("PlatformRecords\\AutoSave"^MapName^".Replay.Gbx");
	wait(MapGhosts != Null);
	if(!MapGhosts.HasSucceeded)
		return Null;
	if(MapGhosts.Ghosts.count > 0)
		return MapGhosts.Ghosts[0];
	return Null;
}

Integer Map_GetPlatformRecord(Text MapName)	{
	declare MapGhost = Map_GetRecordGhost(MapName);
	if(MapGhost == Null)
		return -1;
	return MapGhost.Result.NbRespawns;
}

Void ShowMessage(Text _Text)	{
	Audio.PlaySoundEvent(CAudioManager::ELibSound::ShowDialog, 0, 1.);
	Page.GetFirstChild("LockFrame").Show();
	(Page.GetFirstChild("LockR") as CMlLabel).SetText(_Text);
}

Void ClearShownMaps()	{
	for (y, 1, 15)	{
		(Page.GetFirstChild("M_Main"^y) as CMlQuad).Hide();
		(Page.GetFirstChild("M_Icon"^y) as CMlQuad).Hide();
		(Page.GetFirstChild("M_Medal"^y) as CMlQuad).Hide();
		(Page.GetFirstChild("M_Lock"^y) as CMlFrame).Hide();
		(Page.GetFirstChild("M_Name"^y) as CMlLabel).SetText("");
		(Page.GetFirstChild("M_PlatformRecord"^y) as CMlLabel).SetText("");
	}
}

Integer Map_GetMedalCount(CMapInfo Map, Integer Record_NbRespawns)	{
	if(Record_NbRespawns == -1)
		return 0;

	declare Integer Author = 0;
	declare Integer Gold = 1;
	declare Integer Silver = 3;
	declare Integer Bronze = 10;
	
	if(Map.TMObjective_AuthorTime > 0 && Map.TMObjective_AuthorTime < 100)	{
		Author = Map.TMObjective_AuthorTime;
		Gold = Map.TMObjective_GoldTime;
		Silver = Map.TMObjective_SilverTime;
		Bronze = Map.TMObjective_BronzeTime;
	}
	
	if(Record_NbRespawns <= Author && Author != Gold)
		return 4;
	else if(Record_NbRespawns <= Gold)
		return 3;
	else if(Record_NbRespawns <= Silver)
		return 2;
	else if(Record_NbRespawns <= Bronze)
		return 1;
	return 0;
}

Void ReloadAllRecords()	{
	MedalsTotal = 0;
	declare CurFoldersTask = DataFileMgr.Map_GetGameList(CampaignPath, False);
	sleep(100);
	wait(!CurFoldersTask.IsProcessing);
	declare MaxCol = CurFoldersTask.SubFolders.count - 1;
	if(MaxCol > 4)
		MaxCol = 4;
	for (Col, 0, MaxCol) {
		declare CurMapInfosTask = DataFileMgr.Map_GetGameList(CurFoldersTask.SubFolders[Col], False);
		sleep(50);
		foreach (Map in CurMapInfosTask.MapInfos) {	
			declare Integer Record_NbRespawns = Map_GetPlatformRecord(Map.Name);	
			MapRecords[Map] = Record_NbRespawns;
			declare NbMedals = Map_GetMedalCount(Map, Record_NbRespawns);
			MapMedals[Map] = NbMedals;
			MedalsTotal += NbMedals;
		}
	}



	(Page.GetFirstChild("MedalsLabel") as CMlLabel).SetText("" ^ MedalsTotal);
	
}

Void UpdateMapSelection(CTaskResult_MapList _MapInfosTask)	{

	declare Text ScContext = "";
	wait(!_MapInfosTask.IsProcessing);	
	ClearShownMaps();
	
	declare i = 1;
	foreach (Map in _MapInfosTask.MapInfos)	{
		if(i > 15)
			continue;			
	
	if (Map.Unlocked == False) {
		(Page.GetFirstChild("M_Lock"^i) as CMlFrame).Show();
		(Page.GetFirstChild("M_Name"^i) as CMlLabel).SetText("");
		(Page.GetFirstChild("M_Icon"^i) as CMlQuad).ImageUrl = "";
		(Page.GetFirstChild("M_Medal"^i) as CMlQuad).Hide();
		(Page.GetFirstChild("M_PlatformRecord"^i) as CMlLabel).SetText("");
	}
	else	{
		(Page.GetFirstChild("M_Icon"^i) as CMlQuad).ImageUrl = "file://Thumbnails/MapUid/"^Map.MapUid;
		(Page.GetFirstChild("M_Lock"^i) as CMlFrame).Hide();
		(Page.GetFirstChild("M_Name"^i) as CMlLabel).SetText(Map.Name);
		(Page.GetFirstChild("M_Medal"^i) as CMlQuad).Show();
	}
	
	switch (MapMedals[Map])	{
		case 4: {
			(Page.GetFirstChild("M_Medal"^i) as CMlQuad).Substyle = "MedalNadeo";
		}				
		case 3: {
			(Page.GetFirstChild("M_Medal"^i) as CMlQuad).Substyle = "MedalGold";
			}
		case 2: {
			(Page.GetFirstChild("M_Medal"^i) as CMlQuad).Substyle = "MedalSilver";
		}
		case 1: {
			(Page.GetFirstChild("M_Medal"^i) as CMlQuad).Substyle = "MedalBronze";
		}
		case 0: {
			(Page.GetFirstChild("M_Medal"^i) as CMlQuad).Substyle = "MedalSlot";
		}
	}	
	if(MapRecords[Map] != -1)
		(Page.GetFirstChild("M_PlatformRecord"^i) as CMlLabel).SetText(""^MapRecords[Map]);
	else
		(Page.GetFirstChild("M_PlatformRecord"^i) as CMlLabel).SetText("");

		
	(Page.GetFirstChild("M_Main"^i) as CMlQuad).Show();
	(Page.GetFirstChild("M_Icon"^i) as CMlQuad).Show();
	
	i += 1;
	}		
}	

Void GoToSolo()	{
	Page.GetFirstChild("FrameMainMenu").Hide();
	Page.GetFirstChild("FrameSolo").Show();
	Audio.PlaySoundEvent(CAudioManager::ELibSound::HideDialog, 0, 1.);
}

Void GoToMainMenu()	{
	Page.GetFirstChild("FrameSolo").Hide();
	Page.GetFirstChild("FrameMainMenu").Show();
	Audio.PlaySoundEvent(CAudioManager::ELibSound::HideDialog, 0, 1.);
}


main() {	

	declare Text MenuPage = "Main";
	log("the menu is loading...");

	declare UpQuad <=> (Page.MainFrame.GetFirstChild("Up") 	as CMlQuad);
	declare DownQuad <=> (Page.MainFrame.GetFirstChild("Down") 	as CMlQuad);	
	declare MedalsTotal_ <=> (Page.MainFrame.GetFirstChild("MedalsTotal") 	as CMlFrame);
	declare MedalsMap_ <=> (Page.MainFrame.GetFirstChild("MedalsMap") 	as CMlFrame);

	CampaignPath = "PlatformTest";

	declare LoadMapSound = Audio.CreateSound("https://raw.githubusercontent.com/ArkadySK/TMNextPlatform/main/Audio/MenuStartChallenge.wav");
	Audio.ClearAllDelayedSoundsEvents();
	declare Text ScContext = "";
	declare Text Color;	//uroven trate
	
	UpQuad.Hide();

	wait(LoadMapSound != Null);

	declare CurMapInfosTask = DataFileMgr.Map_GetGameList("", False);
	declare CurFoldersTask = DataFileMgr.Map_GetGameList(CampaignPath, False);
	sleep(100);
	wait(!CurFoldersTask.IsProcessing);
	log("menu loaded successfully. If you see this console, close it with CTRL + G.");
	DownQuad.Hide();
		
	EnableMenuNavigation(True, True, Page.GetFirstChild("xko"), 1);
	
	declare Text LastClickedId = "";
	declare Text ProceededId = "";

	
	ReloadAllRecords();

	while(True){	
		switch (Color)	{
			case "A":	{
				CurMapInfosTask = DataFileMgr.Map_GetGameList(CurFoldersTask.SubFolders[0], False);
				UpdateMapSelection(CurMapInfosTask);
				Color = "";
			}
			case "B":	{
				CurMapInfosTask = DataFileMgr.Map_GetGameList(CurFoldersTask.SubFolders[1], False);
				UpdateMapSelection(CurMapInfosTask);
				Color = "";
			}
			case "C":	{
				CurMapInfosTask = DataFileMgr.Map_GetGameList(CurFoldersTask.SubFolders[2], False);
				UpdateMapSelection(CurMapInfosTask);
				Color = "";
			}
			case "D":	{
				CurMapInfosTask = DataFileMgr.Map_GetGameList(CurFoldersTask.SubFolders[3], False);
				UpdateMapSelection(CurMapInfosTask);
				Color = "";
			}
			case "E":	{
				CurMapInfosTask = DataFileMgr.Map_GetGameList(CurFoldersTask.SubFolders[4], False);
				UpdateMapSelection(CurMapInfosTask);
				Color = "";
			}
		}
		
		
    	foreach (Event in PendingEvents) {
			if (Event.Type ==  CMlEvent::Type::MouseClick) {
				if(Event.ControlId != "")
					LastClickedId = Event.ControlId;
				
			}	
		}	

		if(LastClickedId != ProceededId)	{

			ProceededId = LastClickedId;

			for (y, 1, 15)	{				
				if (LastClickedId == "M_Main"^y) {
					
					declare CMapInfo Map;
					Map <=> CurMapInfosTask.MapInfos[y-1];
											
					if ((Page.GetFirstChild("M_Main"^y) as CMlQuad).StyleSelected == False) 	{
						Deselect();
						MedalsTotal_.Hide();
						MedalsMap_.Show();
																
						(Page.GetFirstChild("M_Main"^y) as CMlQuad).StyleSelected = True;
						(Page.GetFirstChild("header0") as CMlLabel).SetText("Official time rankings for "^Map.Name);
						
						declare Integer Record_Time = ScoreMgr.Map_GetRecord(NullId, Map.MapUid, ScContext);
						declare Integer Record_NbRespawns = MapRecords[Map];					
						declare Text RecordText;
						declare Text PlatformRecordText;
						if (Record_Time !=-1)
							RecordText = TimeToText(Record_Time, True);
						else
							RecordText = "Not Played";		
						if (Record_NbRespawns !=-1)
							PlatformRecordText = ""^Record_NbRespawns;
						else
							PlatformRecordText = "Replay not found!";
						
						(Page.GetFirstChild("TrainingMap") as CMlLabel).SetText(RecordText);
						(Page.GetFirstChild("PlatformRecordMap") as CMlLabel).SetText(PlatformRecordText);
					}
					else {
						if(Map.Unlocked)	{
							wait(TitleControl.IsReady);
							TitleControl.PlayMap(Map.FileName, "Modes\\TrackMania\\LegacyMode.Script.txt", "");
							Audio.PlaySoundEvent(LoadMapSound, 0.8, 0);
						}
						else {
							if (Color == "A") {
								ShowMessage("You need a bronze medal on the previous map to unlock this map.");
							}
							else if (Color == "B") {
								ShowMessage("You need a silver medal on the previous map to unlock this map.");
							}
							else if (Color == "C") {
								ShowMessage("You need a silver medal on the previous map to unlock this map.");
							}
							else if (Color == "D") {
								ShowMessage("You need a gold medal on the previous map to unlock this map.");
							}
							else if (Color == "E") {
								ShowMessage("You need a gold medal on all the previous maps to unlock this map.");
							}
						}
						MedalsTotal_.Show();
						MedalsMap_.Hide();
					}
				}
			}
			
			if (LastClickedId == "HideMessageDialog") {
				Page.GetFirstChild("LockFrame").Hide();
				Audio.PlaySoundEvent(CAudioManager::ELibSound::HideDialog, 0, 1.);
			}
			
			if (LastClickedId == "xko") {
				SendCustomEvent("menu_main", [""]);
				
				if(MenuPage == "Main")
					SendCustomEvent("menu_main", [""]);
				else
					GoToMainMenu();
				MenuPage = "Main";
			}
			
			if (LastClickedId == "SoloBTN") {
				GoToSolo();
				MenuPage = "Solo";
			}
			
			if (LastClickedId == "EditorsBTN") {
				ShowMessage("Since this feature is not implemented yet, please use the OpenPlanet's menu to open editors...");
			}
			
			if (LastClickedId == "WhiteBTN" || LastClickedId == "GreenBTN" || LastClickedId == "BlueBTN" || LastClickedId == "RedBTN" || LastClickedId == "BlackBTN")	{
				Deselect();
				RefreshRank();
				MedalsTotal_ .Show();
				MedalsMap_ .Hide();
				Audio.PlaySoundEvent(CAudioManager::ELibSound::Valid, 0, 1.);
			}
			if (LastClickedId == "WhiteBTN" && Color != "A")  {
				if(CurFoldersTask.SubFolders.count > 0)
					Color = "A";
				else
					ShowMessage("Folder not found!");
			} 
			if (LastClickedId == "GreenBTN" && Color != "B") {
				if(CurFoldersTask.SubFolders.count > 1)
					Color = "B";
				else
					ShowMessage("Folder not found!");
			} 
			if (LastClickedId == "BlueBTN" && Color != "C")	{
				if(CurFoldersTask.SubFolders.count > 2)
					Color = "C";
				else
					ShowMessage("Folder not found!");
			}
			if (LastClickedId == "RedBTN" && Color != "D") {
				if(CurFoldersTask.SubFolders.count > 3)
					Color = "D";
				else
					ShowMessage("Folder not found!");
			}
			if (LastClickedId == "BlackBTN" && Color != "E") {
				if(CurFoldersTask.SubFolders.count > 4)
					Color = "E";
				else
					ShowMessage("Folder not found!");
			}

			LastClickedId = "";
			ProceededId = "";
		}

		yield;
	}
	log("this very page was done by arkady, 2023 :)");	
}
--></script>
</manialink>